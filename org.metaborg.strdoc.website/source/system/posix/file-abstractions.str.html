<code id="0"><span style="color: rgb(127, 0, 85)">module</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">system/posix/file-abstractions</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1"></span><span style="color: rgb(127, 0, 85)">imports</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 0)">system/posix/file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="3"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="4"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="5"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="6"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="7"></span><span style="color: rgb(63, 127, 95)">   * Return the absolute path of a pathname.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="8"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="9"></span><span style="color: rgb(63, 127, 95)">   * @type  String -&gt; String</span><span style="color: rgb(63, 127, 95)"></code>
<code id="10"></span><span style="color: rgb(63, 127, 95)">   * @since 0.9.4</span><span style="color: rgb(63, 127, 95)"></code>
<code id="11"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="12"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">abspath</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="13"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 64, 128)">is-abspath</span><span style="color: rgb(63, 127, 95)"></code>
<code id="14"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(63, 127, 95)"></code>
<code id="15"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">getcwd</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;/&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="16"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="17"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">file-newer</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="18"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">modification-time</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">modification-time</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">gt</span><span style="color: rgb(63, 127, 95)"></code>
<code id="19"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="20"></span><span style="color: rgb(127, 0, 85)">overlays</span><span style="color: rgb(63, 127, 95)"></code>
<code id="21"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="22"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">Read</span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">R_OK</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="23"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">Write</span><span style="color: rgb(0, 64, 128)">     </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">W_OK</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="24"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">Execute</span><span style="color: rgb(0, 64, 128)">   </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">X_OK</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="25"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">Existence</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">F_OK</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="26"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="27"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="28"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="29"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="30"></span><span style="color: rgb(63, 127, 95)">   * @type  String -&gt; String</span><span style="color: rgb(63, 127, 95)"></code>
<code id="31"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="32"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">file-exists</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="33"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">access</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">F_OK</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="34"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="35"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="36"></span><span style="color: rgb(63, 127, 95)">   * @type  String -&gt; String</span><span style="color: rgb(63, 127, 95)"></code>
<code id="37"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="38"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">can-read-file</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="39"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">access</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">R_OK</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="40"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="41"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">is-readable</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">can-read-file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="42"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="43"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="44"></span><span style="color: rgb(63, 127, 95)">   * @type  String -&gt; String</span><span style="color: rgb(63, 127, 95)"></code>
<code id="45"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="46"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">can-write-file</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="47"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">access</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">W_OK</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="48"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="49"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">is-writable</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">can-write-file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="50"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="51"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="52"></span><span style="color: rgb(63, 127, 95)">   * @type  String -&gt; String</span><span style="color: rgb(63, 127, 95)"></code>
<code id="53"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="54"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">can-execute-file</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="55"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">access</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">X_OK</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="56"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="57"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">is-executable</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">can-execute-file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="58"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="59"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="60"></span><span style="color: rgb(63, 127, 95)">   * @type String -&gt; String</span><span style="color: rgb(63, 127, 95)"></code>
<code id="61"></span><span style="color: rgb(63, 127, 95)">   * @inc  create?</span><span style="color: rgb(63, 127, 95)"></code>
<code id="62"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="63"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">can-create-file</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="64"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dirname</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">can-write-file</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="65"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="66"></span><span style="color: rgb(63, 127, 95)">/**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="67"></span><span style="color: rgb(63, 127, 95)"> * find files in paths</span><span style="color: rgb(63, 127, 95)"></code>
<code id="68"></span><span style="color: rgb(63, 127, 95)"> *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="69"></span><span style="color: rgb(63, 127, 95)"> * @todo Create a file-exists based on fopen to make this code portable?</span><span style="color: rgb(63, 127, 95)"></code>
<code id="70"></span><span style="color: rgb(63, 127, 95)"> */</code>
<code id="71"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="72"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="73"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="74"></span><span style="color: rgb(63, 127, 95)">   * Finds a file in a list of directories (a path).</span><span style="color: rgb(63, 127, 95)"></code>
<code id="75"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="76"></span><span style="color: rgb(63, 127, 95)">   * &lt;find-path(strict|path)&gt; f looks for a file with name f in the list of</span><span style="color: rgb(63, 127, 95)"></code>
<code id="77"></span><span style="color: rgb(63, 127, 95)">   * directories path. If the file is not found the behaviour depends on the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="78"></span><span style="color: rgb(63, 127, 95)">   * strategy strict, if it succeeds a fatal-error is flagged, otherwise the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="79"></span><span style="color: rgb(63, 127, 95)">   * strategy just fails.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="80"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="81"></span><span style="color: rgb(63, 127, 95)">   * Example (when run in strategoxt root):</span><span style="color: rgb(63, 127, 95)"></code>
<code id="82"></span><span style="color: rgb(63, 127, 95)">   *   &lt;find-in-path(id|[&quot;ssl/spec&quot;,&quot;ssl/tests&quot;])&gt; &quot;file.str&quot; =&gt; &quot;ssl/spec/file.str&quot;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="83"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="84"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="85"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">strict</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="86"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="87"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">file-exists</span><span style="color: rgb(63, 127, 95)"></code>
<code id="88"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">file-exists</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 255)">&quot;/&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">file</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(63, 127, 95)"></code>
<code id="89"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">strict</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fatal-error</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;no such file: &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">file</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="90"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="91"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="92"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="93"></span><span style="color: rgb(63, 127, 95)">   * Finds a file in a list of directories (a path).</span><span style="color: rgb(63, 127, 95)"></code>
<code id="94"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="95"></span><span style="color: rgb(63, 127, 95)">   * Differs from find-in-path/(0,0) in that it exits with fatal-error if file is</span><span style="color: rgb(63, 127, 95)"></code>
<code id="96"></span><span style="color: rgb(63, 127, 95)">   * not found.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="97"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="98"></span><span style="color: rgb(63, 127, 95)">   * @param should build a list of paths in which the search is performed.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="99"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="100"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="101"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="102"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="103"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="104"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="105"></span><span style="color: rgb(63, 127, 95)">   * Finds a file in a list of directories (a path)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="106"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="107"></span><span style="color: rgb(63, 127, 95)">   * @obsolete.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="108"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="109"></span><span style="color: rgb(63, 127, 95)">   * This strategy operates on a tuple (f, [d*]) where f is the name of the file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="110"></span><span style="color: rgb(63, 127, 95)">   * to be found, and d* are the directories to search in. The full path of the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="111"></span><span style="color: rgb(63, 127, 95)">   * first match is the output term.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="112"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="113"></span><span style="color: rgb(63, 127, 95)">   * Example (when run in strategoxt root):</span><span style="color: rgb(63, 127, 95)"></code>
<code id="114"></span><span style="color: rgb(63, 127, 95)">   *   &lt;find-in-path&gt; (&quot;file.str&quot;, [&quot;ssl/spec&quot;, &quot;ssl/tests&quot;]) =&gt; &quot;ssl/spec/file.str&quot;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="115"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="116"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="117"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="118"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">file</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="119"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="120"></span><span style="color: rgb(63, 127, 95)">  /** </span><span style="color: rgb(63, 127, 95)"></code>
<code id="121"></span><span style="color: rgb(63, 127, 95)">   * @obsolete</span><span style="color: rgb(63, 127, 95)"></code>
<code id="122"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="123"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="124"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">mkpath</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="125"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">mkpath</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="126"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="127"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="128"></span><span style="color: rgb(63, 127, 95)">   * Finds one file with a specific file extension in a list of directories.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="129"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="130"></span><span style="color: rgb(63, 127, 95)">   * This strategy operates on a tuple (f, [d*]). The one file that will be</span><span style="color: rgb(63, 127, 95)"></code>
<code id="131"></span><span style="color: rgb(63, 127, 95)">   * searched for is determined by the basename of f and the requested file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="132"></span><span style="color: rgb(63, 127, 95)">   * extension.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="133"></span><span style="color: rgb(63, 127, 95)">   * Example:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="134"></span><span style="color: rgb(63, 127, 95)">   *   &lt;find-file(!&quot;rtree&quot;)&gt; (&quot;file.str&quot;, [&quot;.&quot;])</span><span style="color: rgb(63, 127, 95)"></code>
<code id="135"></span><span style="color: rgb(63, 127, 95)">   * searches for file.rtree in the current dir.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="136"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="137"></span><span style="color: rgb(63, 127, 95)">   * @param should build the file extension as a string.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="138"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="139"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="140"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">find-file</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">ext</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="141"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">guarantee-extension</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">ext</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="142"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="143"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="144"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">find-file</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">ext</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="145"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">file</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="146"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">find-file</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">ext</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">path</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="147"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="148"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="149"></span><span style="color: rgb(63, 127, 95)">   * @obsolete</span><span style="color: rgb(63, 127, 95)"></code>
<code id="150"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="151"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">find-file</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">ext</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="152"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">find-file</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">ext</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="153"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="154"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="155"></span><span style="color: rgb(63, 127, 95)">   * Finds one file with a specific file extension in a list of directories.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="156"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="157"></span><span style="color: rgb(63, 127, 95)">   * Differs from find-file/(1,0) in that it exits with fatal error if file is</span><span style="color: rgb(63, 127, 95)"></code>
<code id="158"></span><span style="color: rgb(63, 127, 95)">   * not found.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="159"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="160"></span><span style="color: rgb(63, 127, 95)">   * @param should build a list of paths in which the search is performed.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="161"></span><span style="color: rgb(63, 127, 95)">   * @param should build the file extension as a string.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="162"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="163"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">find-file</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">mkpath</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ext</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="164"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">guarantee-extension</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">ext</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="165"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">find-in-path</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">mkpath</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="166"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="167"></span><span style="color: rgb(63, 127, 95)">/**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="168"></span><span style="color: rgb(63, 127, 95)"> * Obsolete strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="169"></span><span style="color: rgb(63, 127, 95)"> */    </code>
<code id="170"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="171"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="172"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="173"></span><span style="color: rgb(63, 127, 95)">   * Creates a fresh file in the current directory.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="174"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="175"></span><span style="color: rgb(63, 127, 95)">   * @obsolete  use new-temp-file or XTC temporary files</span><span style="color: rgb(63, 127, 95)"></code>
<code id="176"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="177"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">new-file</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="178"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">obsolete</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;new-file; use new-temp-file or XTC temporary files&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="179"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rec</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">conc-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;.tmp&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">file-exists</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">x</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="180"></span></code>
