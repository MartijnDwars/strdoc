<code id="0"><span style="color: rgb(63, 127, 95)">/**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1"></span><span style="color: rgb(63, 127, 95)"> * A revised version of the pre-0.9.5 dynamic-rules-tools</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2"></span><span style="color: rgb(63, 127, 95)"> * Now using the new hash-tables, and implementing scoping</span><span style="color: rgb(63, 127, 95)"></code>
<code id="3"></span><span style="color: rgb(63, 127, 95)"> * as a 'stack' of hashtables.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="4"></span><span style="color: rgb(63, 127, 95)"> *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="5"></span><span style="color: rgb(63, 127, 95)"> * @todo reuse ChangeSets when applying the fix point operator</span><span style="color: rgb(63, 127, 95)"></code>
<code id="6"></span><span style="color: rgb(63, 127, 95)"> * @todo provide constructs to handle do-while-like structures</span><span style="color: rgb(63, 127, 95)"></code>
<code id="7"></span><span style="color: rgb(63, 127, 95)"> *       issues: - a break inside the do-while</span><span style="color: rgb(63, 127, 95)"></code>
<code id="8"></span><span style="color: rgb(63, 127, 95)"> *               - propagation in the first run could be wrong</span><span style="color: rgb(63, 127, 95)"></code>
<code id="9"></span><span style="color: rgb(63, 127, 95)"> * @todo investigate if BreakCS and SplitPos need (rulename, label)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="10"></span><span style="color: rgb(63, 127, 95)"> *       or if rulename + scoping of DR_BREAK suffices</span><span style="color: rgb(63, 127, 95)"></code>
<code id="11"></span><span style="color: rgb(63, 127, 95)"> * @todo when we have a fork-and-merge, after the two change sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="12"></span><span style="color: rgb(63, 127, 95)"> *       are merged, one of them is lost and not discarded. This needs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="13"></span><span style="color: rgb(63, 127, 95)"> *       to be fixed (unless the garbage collector takes care of this)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="14"></span><span style="color: rgb(63, 127, 95)"> */</code>
<code id="15"></span><span style="color: rgb(127, 0, 85)">module</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lang/dynamic-rules</span><span style="color: rgb(63, 127, 95)"></code>
<code id="16"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="17"></span><span style="color: rgb(127, 0, 85)">imports</span><span style="color: rgb(63, 127, 95)"></code>
<code id="18"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 0)">collection/hash-table/common</span><span style="color: rgb(63, 127, 95)"></code>
<code id="19"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 0)">strategy/traversal/simple</span><span style="color: rgb(63, 127, 95)"></code>
<code id="20"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 0)">collection/set/indexed</span><span style="color: rgb(63, 127, 95)"></code>
<code id="21"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 0)">system/io/file</span><span style="color: rgb(63, 127, 95)"></code>
<code id="22"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="23"></span><span style="color: rgb(127, 0, 85)">signature</span><span style="color: rgb(63, 127, 95)"></code>
<code id="24"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(127, 0, 85)">constructors</span><span style="color: rgb(63, 127, 95)"></code>
<code id="25"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IndexedSet</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="26"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IndexedSet</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IndexedSet</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="27"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="28"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(63, 127, 95)"></code>
<code id="29"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">SplitPos</span><span style="color: rgb(63, 127, 95)">   </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">SplitPos</span><span style="color: rgb(63, 127, 95)"></code>
<code id="30"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">BreakCS</span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">BreakCS</span><span style="color: rgb(63, 127, 95)"></code>
<code id="31"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">ContinueCS</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ContinueCS</span><span style="color: rgb(63, 127, 95)"></code>
<code id="32"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(63, 127, 95)"></code>
<code id="33"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(63, 127, 95)"></code>
<code id="34"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="35"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(63, 127, 95)"></code>
<code id="36"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(63, 127, 95)"></code>
<code id="37"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Int</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(63, 127, 95)"></code>
<code id="38"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(63, 127, 95)">   </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(63, 127, 95)"></code>
<code id="39"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(63, 127, 95)"></code>
<code id="40"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(63, 127, 95)"></code>
<code id="41"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">ExceptionCS</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">String</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ExceptionCS</span><span style="color: rgb(63, 127, 95)"></code>
<code id="42"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="43"></span><span style="color: rgb(63, 127, 95)">/**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="44"></span><span style="color: rgb(63, 127, 95)"> * Currently active rule set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="45"></span><span style="color: rgb(63, 127, 95)"> */</code>
<code id="46"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="47"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="48"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="49"></span><span style="color: rgb(63, 127, 95)">   * Retrieve the primitive dynamic rules hashtable.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="50"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="51"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-rule-sets-hashtable</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="52"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_dynamic_rules_hashtable&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="53"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="54"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="55"></span><span style="color: rgb(63, 127, 95)">   * @type  _ -&gt; List(RuleScope)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="56"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="57"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="58"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_get&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-rule-sets-hashtable</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="59"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-new-rule-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="60"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="61"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="62"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="63"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="64"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="65"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_put&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-rule-sets-hashtable</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="66"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="67"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="68"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-switch-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="69"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="70"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="71"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="72"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="73"></span><span style="color: rgb(63, 127, 95)">  // Note: the storing the currently active rule set should</span><span style="color: rgb(63, 127, 95)"></code>
<code id="74"></span><span style="color: rgb(63, 127, 95)">  // be done in a global variable at the C level (probably).</span><span style="color: rgb(63, 127, 95)"></code>
<code id="75"></span><span style="color: rgb(63, 127, 95)">  // We should abstract from that as much as possible and</span><span style="color: rgb(63, 127, 95)"></code>
<code id="76"></span><span style="color: rgb(63, 127, 95)">  // just consider the rule-set as a value that can be</span><span style="color: rgb(63, 127, 95)"></code>
<code id="77"></span><span style="color: rgb(63, 127, 95)">  // changed. Manipulating the content should be the same</span><span style="color: rgb(63, 127, 95)"></code>
<code id="78"></span><span style="color: rgb(63, 127, 95)">  // for any storage solution we use.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="79"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="80"></span><span style="color: rgb(63, 127, 95)">  // a question to consider: should operations be relative</span><span style="color: rgb(63, 127, 95)"></code>
<code id="81"></span><span style="color: rgb(63, 127, 95)">  // to the current rule-set or should we make a set of</span><span style="color: rgb(63, 127, 95)"></code>
<code id="82"></span><span style="color: rgb(63, 127, 95)">  // operations that work on a named rule-set and deal</span><span style="color: rgb(63, 127, 95)"></code>
<code id="83"></span><span style="color: rgb(63, 127, 95)">  // with the pointer change at a higer-level?</span><span style="color: rgb(63, 127, 95)"></code>
<code id="84"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="85"></span><span style="color: rgb(63, 127, 95)">  // Well, we can actually have two APIs, one working on</span><span style="color: rgb(63, 127, 95)"></code>
<code id="86"></span><span style="color: rgb(63, 127, 95)">  // the implicit global rule-set, and the other working</span><span style="color: rgb(63, 127, 95)"></code>
<code id="87"></span><span style="color: rgb(63, 127, 95)">  // on the explicit representation.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="88"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="89"></span><span style="color: rgb(63, 127, 95)">  // whose responsibility is it to initialize the outer scope?</span><span style="color: rgb(63, 127, 95)"></code>
<code id="90"></span><span style="color: rgb(63, 127, 95)">  // In the definition above an initial hashtable is created</span><span style="color: rgb(63, 127, 95)"></code>
<code id="91"></span><span style="color: rgb(63, 127, 95)">  // when no rule-set was available yet.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="92"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="93"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // high-level API with implicit rule set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="94"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="95"></span><span style="color: rgb(63, 127, 95)">  // Note that the compiler can generate a specifically named</span><span style="color: rgb(63, 127, 95)"></code>
<code id="96"></span><span style="color: rgb(63, 127, 95)">  // rule for each of the strategies in this API, e.g,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="97"></span><span style="color: rgb(63, 127, 95)">  // add-rule-name, lookup-rule-name, etc. Then the compiler</span><span style="color: rgb(63, 127, 95)"></code>
<code id="98"></span><span style="color: rgb(63, 127, 95)">  // can specialize the applications.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="99"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="100"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-scope</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="101"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-begin-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="102"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-end-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="103"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-end-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="104"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="105"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="106"></span><span style="color: rgb(63, 127, 95)">   * @type  t -&gt; t</span><span style="color: rgb(63, 127, 95)"></code>
<code id="107"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="108"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-begin-scope</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="109"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="110"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="111"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-add-scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="112"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="113"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="114"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="115"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="116"></span><span style="color: rgb(63, 127, 95)">   * @type  t -&gt; t</span><span style="color: rgb(63, 127, 95)"></code>
<code id="117"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="118"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-end-scope</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="119"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="120"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="121"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-leave-scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="122"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="123"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="124"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="125"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="126"></span><span style="color: rgb(63, 127, 95)">   * Scope all dynamic rules.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="127"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="128"></span><span style="color: rgb(63, 127, 95)">   * @note While get-config and set-config do not actually use dynamic rules,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="129"></span><span style="color: rgb(63, 127, 95)">   *       this strategy also scopes the config hashtable.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="130"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="131"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-scope-all</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="132"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">{|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">DrScopedRules</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">DrScopedConfig</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="133"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="134"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">dr-scope-all-start</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"></code>
<code id="135"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-scope-all-end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="136"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="137"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">|}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="138"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="139"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="140"></span><span style="color: rgb(63, 127, 95)">   * Start a new scope for all dynamic rules.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="141"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="142"></span><span style="color: rgb(63, 127, 95)">   * @note While get-config and set-config do not actually use dynamic rules,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="143"></span><span style="color: rgb(63, 127, 95)">   *       this strategy also scopes the config hashtable.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="144"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="145"></span><span style="color: rgb(63, 127, 95)">   * @see dr-scope-all(s)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="146"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="147"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-scope-all-start</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="148"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="149"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 0)">config</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:=</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">lookup-table</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;config&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="150"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">table-hashtable</span><span style="color: rgb(63, 127, 95)"></code>
<code id="151"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;config&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-copy</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">config</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="152"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:=</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-rule-sets-hashtable</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="153"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:=</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;DrScopedRules&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="154"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(63, 127, 95)"></code>
<code id="155"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-begin-scopes</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="156"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="157"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">DrScopedRules</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:=</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(63, 127, 95)"></code>
<code id="158"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">DrScopedConfig</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:=</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">config</span><span style="color: rgb(63, 127, 95)"></code>
<code id="159"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="160"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="161"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="162"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="163"></span><span style="color: rgb(63, 127, 95)">   * End a scope for all dynamic rules.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="164"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="165"></span><span style="color: rgb(63, 127, 95)">   * @see dr-scope-all(s)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="166"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="167"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-scope-all-end</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="168"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="169"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:=</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-rule-sets-hashtable</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="170"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:=</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DrScopedRules</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="171"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">table-hashtable</span><span style="color: rgb(63, 127, 95)"></code>
<code id="172"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;config&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DrScopedConfig</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="173"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-end-scopes</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="174"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(63, 127, 95)"></code>
<code id="175"></span><span style="color: rgb(63, 127, 95)">      // Remove other, newly defined rules</span><span style="color: rgb(63, 127, 95)"></code>
<code id="176"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">diff</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="177"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">list-loop</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="178"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"></code>
<code id="179"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(63, 127, 95)"></code>
<code id="180"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="181"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="182"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="183"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="184"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-scopes</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="185"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-begin-scopes</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="186"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-end-scopes</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="187"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-end-scopes</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="188"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="189"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="190"></span><span style="color: rgb(63, 127, 95)">   * @type  t -&gt; t</span><span style="color: rgb(63, 127, 95)"></code>
<code id="191"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="192"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-begin-scopes</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="193"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="194"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(63, 127, 95)"></code>
<code id="195"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(63, 127, 95)"></code>
<code id="196"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="197"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-add-scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="198"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="199"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="200"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="201"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="202"></span><span style="color: rgb(63, 127, 95)">   * @type  t -&gt; t</span><span style="color: rgb(63, 127, 95)"></code>
<code id="203"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="204"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-end-scopes</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="205"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="206"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(63, 127, 95)"></code>
<code id="207"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(63, 127, 95)"></code>
<code id="208"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="209"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-leave-scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="210"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="211"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="212"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="213"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="214"></span><span style="color: rgb(63, 127, 95)">   * @type  t -&gt; t</span><span style="color: rgb(63, 127, 95)"></code>
<code id="215"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="216"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="217"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="218"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="219"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="220"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="221"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="222"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="223"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="224"></span><span style="color: rgb(63, 127, 95)">   * @type  t -&gt; t</span><span style="color: rgb(63, 127, 95)"></code>
<code id="225"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="226"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="227"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="228"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="229"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="230"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="231"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="232"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="233"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="234"></span><span style="color: rgb(63, 127, 95)">   * @type  t -&gt; t</span><span style="color: rgb(63, 127, 95)"></code>
<code id="235"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="236"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="237"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="238"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="239"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="240"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="241"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="242"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="243"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="244"></span><span style="color: rgb(63, 127, 95)">   * @type  t -&gt; t</span><span style="color: rgb(63, 127, 95)"></code>
<code id="245"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="246"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-label-scope</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="247"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="248"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="249"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-label-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="250"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="251"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="252"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="253"></span><span style="color: rgb(63, 127, 95)">   /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="254"></span><span style="color: rgb(63, 127, 95)">    * Get all scope labels ordered from inner, most recent, to outer, oldest.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="255"></span><span style="color: rgb(63, 127, 95)">    */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="256"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="257"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-get-scope-labels</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="258"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="259"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-scope-labels</span><span style="color: rgb(63, 127, 95)"></code>
<code id="260"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="261"></span><span style="color: rgb(63, 127, 95)">   /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="262"></span><span style="color: rgb(63, 127, 95)">    * Get the first scope label for which s succeeds starting with the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="263"></span><span style="color: rgb(63, 127, 95)">    * inner, most recent, scope.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="264"></span><span style="color: rgb(63, 127, 95)">    */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="265"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="266"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-get-first-scope-label</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="267"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="268"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-first-scope-label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="269"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="270"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="271"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="272"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="273"></span><span style="color: rgb(63, 127, 95)">   * Apply s in a state where the current dynamic rules for name are ignored.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="274"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="275"></span><span style="color: rgb(63, 127, 95)">   * @param strategy to apply (a -&gt; b)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="276"></span><span style="color: rgb(63, 127, 95)">   * @param name of the dynamic rules (String)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="277"></span><span style="color: rgb(63, 127, 95)">   * @type a -&gt; b</span><span style="color: rgb(63, 127, 95)"></code>
<code id="278"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="279"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-ignore-state</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="280"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="281"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-new-rule-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">newrule</span><span style="color: rgb(63, 127, 95)"></code>
<code id="282"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-switch-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">oldrule</span><span style="color: rgb(63, 127, 95)"></code>
<code id="283"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="284"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"></code>
<code id="285"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="286"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-leave-scope</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">newrule</span><span style="color: rgb(63, 127, 95)"></code>
<code id="287"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">oldrule</span><span style="color: rgb(63, 127, 95)"></code>
<code id="288"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="289"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="290"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="291"></span><span style="color: rgb(63, 127, 95)">   * Apply s in a state where the current dynamic rules for names are ignored.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="292"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="293"></span><span style="color: rgb(63, 127, 95)">   * @param strategy to apply (a -&gt; b)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="294"></span><span style="color: rgb(63, 127, 95)">   * @param names of the dynamic rules (List(String))</span><span style="color: rgb(63, 127, 95)"></code>
<code id="295"></span><span style="color: rgb(63, 127, 95)">   * @type a -&gt; b</span><span style="color: rgb(63, 127, 95)"></code>
<code id="296"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="297"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-ignore-states</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="298"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="299"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 0)">newrules</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:=</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-new-rule-set</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(63, 127, 95)"></code>
<code id="300"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">zip</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-switch-rule-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">oldrules</span><span style="color: rgb(63, 127, 95)"></code>
<code id="301"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="302"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"></code>
<code id="303"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="304"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">list-loop</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-leave-scope</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">newrules</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(63, 127, 95)"></code>
<code id="305"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">zip</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">oldrules</span><span style="color: rgb(63, 127, 95)"></code>
<code id="306"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="307"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="308"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="309"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="310"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="311"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="312"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="313"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="314"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-all-rules</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="315"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="316"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-lookup-all-rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="317"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="318"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-pointer</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="319"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="320"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-pointer</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="321"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="322"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-all-keys</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="323"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="324"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-all-keys</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new-iset</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="325"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="326"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="327"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="328"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="329"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="330"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="331"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="332"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="333"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="334"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="335"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="336"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="337"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="338"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="339"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="340"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-rule-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="341"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="342"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="343"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="344"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="345"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="346"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="347"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-rules-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="348"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="349"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="350"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="351"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="352"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="353"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="354"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-undefine-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="355"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="356"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="357"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="358"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="359"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="360"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="361"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-undefine-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="362"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="363"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="364"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="365"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="366"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="367"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="368"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-undefine-rule-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="369"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="370"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="371"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="372"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="373"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="374"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="375"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="376"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="377"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="378"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="379"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="380"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="381"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="382"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="383"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="384"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="385"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="386"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="387"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="388"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="389"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-rule-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="390"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="391"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="392"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="393"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="394"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="395"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="396"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="397"></span><span style="color: rgb(63, 127, 95)">   * Intersect live rule-set with given rule set changing the live rule set.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="398"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="399"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="400"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-intersect-with</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="401"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-rule-sets</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="402"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="403"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="404"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="405"></span><span style="color: rgb(63, 127, 95)">   * Intersect live rule-set with given rule set changing both.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="406"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="407"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="408"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-intersect-symm</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="409"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-rule-sets-symm</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="410"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="411"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="412"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="413"></span><span style="color: rgb(63, 127, 95)">   * Merge live rule-set with given rule set using union changing the live rule set.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="414"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="415"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="416"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-union-with</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="417"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-rule-sets</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="418"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="419"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="420"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="421"></span><span style="color: rgb(63, 127, 95)">   * Merge live rule-set with give rule set using union changing both.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="422"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="423"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="424"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-union-symm</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="425"></span><span style="color: rgb(0, 64, 128)">//    &lt;dr-union-rule-sets-symm&gt;(&lt;id&gt;, &lt;dr-get-rule-set(|name)&gt;)</span><span style="color: rgb(0, 64, 128)"></code>
<code id="426"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-rule-sets-symm</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="427"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="428"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="429"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="430"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="431"></span><span style="color: rgb(63, 127, 95)">   * Left choice with dynamic rule roll-back in case s1 fails.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="432"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="433"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="434"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-left-choice</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">s2</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="435"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="436"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="437"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="438"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="439"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="440"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="441"></span><span style="color: rgb(63, 127, 95)">/**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="442"></span><span style="color: rgb(63, 127, 95)"> * Low-level API working directly on rule-set.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="443"></span><span style="color: rgb(63, 127, 95)"> */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="444"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="445"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // debugging</span><span style="color: rgb(63, 127, 95)"></code>
<code id="446"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="447"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-save-rule-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="448"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">alltd</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">hashtable-getlist</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="449"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="450"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="451"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="452"></span><span style="color: rgb(63, 127, 95)">  // a rule-set is represented by a list of (label list, hash-table) pairs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="453"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="454"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-new-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="455"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new-iset</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iset-add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new-hashtable</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="456"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="457"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-new-rule-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="458"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-new-scope</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="459"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="460"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="461"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-new-scope</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="462"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="463"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-destroy-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="464"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">iset-destroy</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-destroy</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="465"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="466"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-leave-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="467"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">scope</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scopes</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scopes</span><span style="color: rgb(63, 127, 95)"></code>
<code id="468"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-destroy-scope</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="469"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="470"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-get-inner-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="471"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">scope</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scopes</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="472"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="473"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-label-scope</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="474"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">iset-add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="475"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">iset-add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="476"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="477"></span><span style="color: rgb(63, 127, 95)">    // todo: distinction between rulescope and changeset necessary here or not??</span><span style="color: rgb(63, 127, 95)"></code>
<code id="478"></span><span style="color: rgb(63, 127, 95)">//    [RuleScope(labels, tbl) | scopes] -&gt; [RuleScope([label | labels], tbl) | scopes]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="479"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="480"></span><span style="color: rgb(63, 127, 95)">   </span><span style="color: rgb(0, 64, 128)">dr-get-scope-labels</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="481"></span><span style="color: rgb(0, 64, 128)">     </span><span style="color: rgb(0, 64, 128)">mapconcat</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="482"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="483"></span><span style="color: rgb(63, 127, 95)">   /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="484"></span><span style="color: rgb(63, 127, 95)">    * Get the first scope label for which s succeeds.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="485"></span><span style="color: rgb(63, 127, 95)">    */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="486"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="487"></span><span style="color: rgb(63, 127, 95)">   </span><span style="color: rgb(0, 64, 128)">dr-get-first-scope-label</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="488"></span><span style="color: rgb(0, 64, 128)">     </span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="489"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="490"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="491"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // change sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="492"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="493"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-new-change-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="494"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new-iset</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new-iset</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new-hashtable</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="495"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="496"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="497"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-new-change-set</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="498"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="499"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-destroy-change-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="500"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">iset-destroy</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iset-destroy</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-destroy-and-unmark</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="501"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="502"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-destroy-and-unmark</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="503"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="504"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-destroy</span><span style="color: rgb(63, 127, 95)"></code>
<code id="505"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="506"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelb</span><span style="color: rgb(63, 127, 95)"></code>
<code id="507"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">.</span><span style="color: rgb(0, 0, 0)">labelb</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="508"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="509"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="510"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelc</span><span style="color: rgb(63, 127, 95)"></code>
<code id="511"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">.</span><span style="color: rgb(0, 0, 0)">labelc</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="512"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="513"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="514"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="515"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="516"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="517"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="518"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-clone-change-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="519"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labels1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="520"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-new-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labels2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="521"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-addlist</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">labels1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">labels2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="522"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-addlist</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="523"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="524"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="525"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="526"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="527"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="528"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="529"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="530"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="531"></span><span style="color: rgb(63, 127, 95)">   * The strategy destroy indicates whether the change</span><span style="color: rgb(63, 127, 95)"></code>
<code id="532"></span><span style="color: rgb(63, 127, 95)">   * set should also be destroyed after the commmit.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="533"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="534"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">destroy</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="535"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs''</span><span style="color: rgb(63, 127, 95)"></code>
<code id="536"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="537"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">foldr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-commit-labels</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="538"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-apply-change</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="539"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="540"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">foldr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">rs'</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-apply-removal</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs''</span><span style="color: rgb(63, 127, 95)"></code>
<code id="541"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="542"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">destroy</span><span style="color: rgb(63, 127, 95)"></code>
<code id="543"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelb</span><span style="color: rgb(63, 127, 95)"></code>
<code id="544"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csidnextb</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs''</span><span style="color: rgb(63, 127, 95)"></code>
<code id="545"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csidnextb</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelb</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="546"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-break was called outside of a fix and merge operator or a dr-label call&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="547"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="548"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="549"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">destroy</span><span style="color: rgb(63, 127, 95)"></code>
<code id="550"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelc</span><span style="color: rgb(63, 127, 95)"></code>
<code id="551"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csidnextc</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs''</span><span style="color: rgb(63, 127, 95)"></code>
<code id="552"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csidnextc</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelc</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="553"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-continue was called outside of a fix and merge operator call&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="554"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="555"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="556"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">destroy</span><span style="color: rgb(63, 127, 95)"></code>
<code id="557"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="558"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csidnextt</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs''</span><span style="color: rgb(63, 127, 95)"></code>
<code id="559"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csidnextt</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="560"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-throw was not called in the proper exception handling context&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="561"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="562"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">destroy</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-destroy-change-set</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="563"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="564"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="565"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="566"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-destroy-change-set</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="567"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="568"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-commit-labels</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="569"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">iset-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="570"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">iset-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="571"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="572"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="573"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="574"></span><span style="color: rgb(63, 127, 95)">   * commit to ruleset is finding the first ChangeSet (any) *or* the first</span><span style="color: rgb(63, 127, 95)"></code>
<code id="575"></span><span style="color: rgb(63, 127, 95)">   * RuleScope that has the appropriate scopeid (i.e. hashtable pointer)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="576"></span><span style="color: rgb(63, 127, 95)">   * and setting the key-value into it</span><span style="color: rgb(63, 127, 95)"></code>
<code id="577"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="578"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="579"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-apply-change</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="580"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">key1</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-commit-to-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="581"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="582"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="583"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-commit-to-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="584"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-commit-to-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="585"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-commit-to-rule-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="586"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="587"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-commit-to-change-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="588"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="589"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="590"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"></code>
<code id="591"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="592"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="593"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="594"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="595"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="596"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-commit-to-rule-scope</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="597"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="598"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="599"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-commit-to-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="600"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="601"></span><span style="color: rgb(63, 127, 95)">/*</span><span style="color: rgb(63, 127, 95)"></code>
<code id="602"></span><span style="color: rgb(63, 127, 95)"> * the old implementation (for reference)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="603"></span><span style="color: rgb(63, 127, 95)"> *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="604"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="605"></span><span style="color: rgb(63, 127, 95)">  dr-commit-to-rule-set(|scpid, key, value) =</span><span style="color: rgb(63, 127, 95)"></code>
<code id="606"></span><span style="color: rgb(63, 127, 95)">    fetch(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="607"></span><span style="color: rgb(63, 127, 95)">      dr-commit-to-change-set(|scpid, key, value)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="608"></span><span style="color: rgb(63, 127, 95)">    + dr-commit-to-rule-scope(|scpid, key, value))</span><span style="color: rgb(63, 127, 95)"></code>
<code id="609"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="610"></span><span style="color: rgb(63, 127, 95)">  dr-commit-to-change-set(|scpid, key, value) =</span><span style="color: rgb(63, 127, 95)"></code>
<code id="611"></span><span style="color: rgb(63, 127, 95)">    ?ChangeSet(_, _, tbl)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="612"></span><span style="color: rgb(63, 127, 95)">    ; where(&lt;hashtable-put(|(scpid, key), value)&gt; tbl)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="613"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="614"></span><span style="color: rgb(63, 127, 95)">  dr-commit-to-rule-scope(|scpid, key, value) =</span><span style="color: rgb(63, 127, 95)"></code>
<code id="615"></span><span style="color: rgb(63, 127, 95)">    ?RuleScope(_,tbl@Hashtable(scpid))</span><span style="color: rgb(63, 127, 95)"></code>
<code id="616"></span><span style="color: rgb(63, 127, 95)">    ; where(&lt;hashtable-put(|key, value)&gt; tbl)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="617"></span><span style="color: rgb(63, 127, 95)">*/</span><span style="color: rgb(63, 127, 95)"></code>
<code id="618"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="619"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-apply-removal</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="620"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">key1</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-remove-from-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="621"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="622"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-remove-from-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="623"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="624"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-remove-from-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="625"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-remove-from-rule-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="626"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="627"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-remove-from-change-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="628"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iset-add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="629"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="630"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="631"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-remove-from-rule-scope</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="632"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="633"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="634"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="635"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // looking up</span><span style="color: rgb(63, 127, 95)"></code>
<code id="636"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="637"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="638"></span><span style="color: rgb(63, 127, 95)">   * Fetch the most recent definition for key.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="639"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="640"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="641"></span><span style="color: rgb(63, 127, 95)">  // The &quot;removed&quot; parameter is now a list, which allows duplicates</span><span style="color: rgb(63, 127, 95)"></code>
<code id="642"></span><span style="color: rgb(63, 127, 95)">  // to be added. This is not wrong, but it is marginally inefficient.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="643"></span><span style="color: rgb(63, 127, 95)">  // We actually need set-like behavior. Indexed sets, however, are</span><span style="color: rgb(63, 127, 95)"></code>
<code id="644"></span><span style="color: rgb(63, 127, 95)">  // not an option because of the check of whether or not &quot;removed&quot;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="645"></span><span style="color: rgb(63, 127, 95)">  // contains key' in function look2. Since look2 is called later on,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="646"></span><span style="color: rgb(63, 127, 95)">  // when a RuleScope is reached, &quot;removed&quot; will potentially contain</span><span style="color: rgb(63, 127, 95)"></code>
<code id="647"></span><span style="color: rgb(63, 127, 95)">  // some extra elements which should not be considered. This is the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="648"></span><span style="color: rgb(63, 127, 95)">  // case because of the in-place update of indexed sets.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="649"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="650"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="651"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="652"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="653"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">look</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="654"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="655"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">look</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="656"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(63, 127, 95)"></code>
<code id="657"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="658"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">look</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="659"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="660"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">look1</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="661"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="662"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">look2</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">look1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="663"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="664"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="665"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(63, 127, 95)"></code>
<code id="666"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="667"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="668"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"></code>
<code id="669"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="670"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(63, 127, 95)"></code>
<code id="671"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">look2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">conc</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="672"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="673"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="674"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="675"></span><span style="color: rgb(63, 127, 95)">   * Version of dr-lookup-rule that looks for definition of a key</span><span style="color: rgb(63, 127, 95)"></code>
<code id="676"></span><span style="color: rgb(63, 127, 95)">   * in a particular scope. The expected scope id (scpid) is the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="677"></span><span style="color: rgb(63, 127, 95)">   * pointer to the hashtable of a rule scope and is usually</span><span style="color: rgb(63, 127, 95)"></code>
<code id="678"></span><span style="color: rgb(63, 127, 95)">   * identified by means of a label, i.e., a label indicates the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="679"></span><span style="color: rgb(63, 127, 95)">   * rule scope and the rule scope has a unique scope id.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="680"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="681"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="682"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="683"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope-rs</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="684"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope-cs</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="685"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="686"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope-rs</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="687"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)">      // if this is the right scope,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="688"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)">                      // then check for key</span><span style="color: rgb(63, 127, 95)"></code>
<code id="689"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)">                      // else recurse</span><span style="color: rgb(63, 127, 95)"></code>
<code id="690"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="691"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="692"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope-cs</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="693"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="694"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="695"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)">                                // key is marked for removal, so</span><span style="color: rgb(63, 127, 95)"></code>
<code id="696"></span><span style="color: rgb(63, 127, 95)">                                             // in effect it is not defined</span><span style="color: rgb(63, 127, 95)"></code>
<code id="697"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="698"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="699"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="700"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="701"></span><span style="color: rgb(63, 127, 95)">   * Fetch the most recent definition for key and return a pointer</span><span style="color: rgb(63, 127, 95)"></code>
<code id="702"></span><span style="color: rgb(63, 127, 95)">   * to the table that defines it.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="703"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="704"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="705"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-pointer</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="706"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-pointer</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="707"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="708"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-pointer</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">look</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="709"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="710"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">look</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="711"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(63, 127, 95)"></code>
<code id="712"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="713"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="714"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-pointer</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">look</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="715"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="716"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-pointer</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">look1</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="717"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="718"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">look2</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">look1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="719"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="720"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="721"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(63, 127, 95)"></code>
<code id="722"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="723"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="724"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"></code>
<code id="725"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="726"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(63, 127, 95)"></code>
<code id="727"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-pointer</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">look2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">conc</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="728"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="729"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="730"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="731"></span><span style="color: rgb(63, 127, 95)">   * Fetch all definitions for key.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="732"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="733"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="734"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-all-rules</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="735"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-lookup-all-rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="736"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="737"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-all-rules</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">look</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="738"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="739"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">conc</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">look</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="740"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(63, 127, 95)"></code>
<code id="741"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="742"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="743"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-all-rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">look</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="744"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="745"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-lookup-all-rules</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">look1</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="746"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="747"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">look2</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">look1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="748"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="749"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="750"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(63, 127, 95)"></code>
<code id="751"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="752"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="753"></span><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"></code>
<code id="754"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="755"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(63, 127, 95)"></code>
<code id="756"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-all-rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">look2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">conc</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="757"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="758"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="759"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="760"></span><span style="color: rgb(63, 127, 95)">   * Fetch all keys defined in a rule set.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="761"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="762"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="763"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-all-keys</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">result</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="764"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="765"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">partition</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">localr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="766"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="767"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">localr</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(63, 127, 95)"></code>
<code id="768"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-addlist</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">result</span><span style="color: rgb(63, 127, 95)"></code>
<code id="769"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-all-keys</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">removed'</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">result</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="770"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="771"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-all-keys</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">result</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="772"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="773"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="774"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">conc</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">removed'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="775"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="776"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">removed'</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(63, 127, 95)"></code>
<code id="777"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-addlist</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">keys</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">result</span><span style="color: rgb(63, 127, 95)"></code>
<code id="778"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-all-keys</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">removed'</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">result</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="779"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="780"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-all-keys</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">removed</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">result</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="781"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">result</span><span style="color: rgb(63, 127, 95)"></code>
<code id="782"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="783"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // setting a rule</span><span style="color: rgb(63, 127, 95)"></code>
<code id="784"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="785"></span><span style="color: rgb(63, 127, 95)">  // A rule is always stored as a mapping from key to a list of values.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="786"></span><span style="color: rgb(63, 127, 95)">  // Setting a rule entails removing previous rules.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="787"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="788"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="789"></span><span style="color: rgb(63, 127, 95)">   * set a rule in the inner scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="790"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="791"></span><span style="color: rgb(63, 127, 95)">   * The inner scope has label () since all scopes are labeled</span><span style="color: rgb(63, 127, 95)"></code>
<code id="792"></span><span style="color: rgb(63, 127, 95)">   * this way.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="793"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="794"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="795"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="796"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="797"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="798"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="799"></span><span style="color: rgb(63, 127, 95)">   * set a rule in the scope with specified label</span><span style="color: rgb(63, 127, 95)"></code>
<code id="800"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="801"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="802"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="803"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-set-fail</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="804"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="805"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-fail</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="806"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"></code>
<code id="807"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="808"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 64, 128)"></code>
<code id="809"></span><span style="color: rgb(0, 64, 128)">           </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="810"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="811"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="812"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="813"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="814"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="815"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="816"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="817"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="818"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">set1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 64, 128)"></code>
<code id="819"></span><span style="color: rgb(0, 64, 128)">           </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="820"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="821"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="822"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">set2</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="823"></span><span style="color: rgb(0, 64, 128)">              </span><span style="color: rgb(0, 64, 128)">set1</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="824"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"></code>
<code id="825"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="826"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="827"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="828"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="829"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="830"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="831"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">set2</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="832"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">set2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="833"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="834"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="835"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="836"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="837"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="838"></span><span style="color: rgb(63, 127, 95)">    // what to do if no scope with the label is defined?</span><span style="color: rgb(63, 127, 95)"></code>
<code id="839"></span><span style="color: rgb(63, 127, 95)">    // currently this fails. This might default to adding to</span><span style="color: rgb(63, 127, 95)"></code>
<code id="840"></span><span style="color: rgb(63, 127, 95)">    // the inner scope and labeling that inner scope as</span><span style="color: rgb(63, 127, 95)"></code>
<code id="841"></span><span style="color: rgb(63, 127, 95)">    // well. However, that is quite expensive since</span><span style="color: rgb(63, 127, 95)"></code>
<code id="842"></span><span style="color: rgb(63, 127, 95)">    // it would entail first going through all scopes to</span><span style="color: rgb(63, 127, 95)"></code>
<code id="843"></span><span style="color: rgb(63, 127, 95)">    // establish non-existence of a label.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="844"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="845"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="846"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="847"></span><span style="color: rgb(63, 127, 95)">   * Add a rule to the rule-set with the specified label and make sure</span><span style="color: rgb(63, 127, 95)"></code>
<code id="848"></span><span style="color: rgb(63, 127, 95)">   * it is visible by deleting any rules with the same key in scopes</span><span style="color: rgb(63, 127, 95)"></code>
<code id="849"></span><span style="color: rgb(63, 127, 95)">   * upto the specified scope. Deleting by removing from the table, not</span><span style="color: rgb(63, 127, 95)"></code>
<code id="850"></span><span style="color: rgb(63, 127, 95)">   * undefining.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="851"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="852"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="853"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="854"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="855"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="856"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="857"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-set-fail</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-rm-fail</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="858"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="859"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-rm-fail</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="860"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"></code>
<code id="861"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="862"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)"></code>
<code id="863"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 0, 0)">set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="864"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 0)">rm</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 64, 128)"></code>
<code id="865"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"></code>
<code id="866"></span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="867"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="868"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="869"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 64, 128)">set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="870"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="871"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="872"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">rm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="873"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">set</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">rm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="874"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="875"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="876"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="877"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)"></code>
<code id="878"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 0, 0)">set1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="879"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 0)">rm1</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 64, 128)"></code>
<code id="880"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"></code>
<code id="881"></span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="882"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="883"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">set2</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="884"></span><span style="color: rgb(0, 64, 128)">              </span><span style="color: rgb(0, 64, 128)">set1</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="885"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"></code>
<code id="886"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="887"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="888"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="889"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="890"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="891"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">rm2</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="892"></span><span style="color: rgb(0, 64, 128)">              </span><span style="color: rgb(0, 64, 128)">rm1</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="893"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="894"></span><span style="color: rgb(63, 127, 95)">                   </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="895"></span><span style="color: rgb(63, 127, 95)">                   </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="896"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="897"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="898"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="899"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="900"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">set2</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="901"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="902"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-in-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">set2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">rm2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="903"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="904"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="905"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="906"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="907"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // extending a rule</span><span style="color: rgb(63, 127, 95)"></code>
<code id="908"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="909"></span><span style="color: rgb(63, 127, 95)">  // Extending a rule entails adding a value to the list of values</span><span style="color: rgb(63, 127, 95)"></code>
<code id="910"></span><span style="color: rgb(63, 127, 95)">  // corresponding to the key. The intended semantics is that all</span><span style="color: rgb(63, 127, 95)"></code>
<code id="911"></span><span style="color: rgb(63, 127, 95)">  // these values are</span><span style="color: rgb(63, 127, 95)"></code>
<code id="912"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="913"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="914"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="915"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="916"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="917"></span><span style="color: rgb(63, 127, 95)">   * add a rule to the scope for label</span><span style="color: rgb(63, 127, 95)"></code>
<code id="918"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="919"></span><span style="color: rgb(63, 127, 95)">   * @assert: dr-add-to-rule-set(|l, k, v)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="920"></span><span style="color: rgb(63, 127, 95)">   *               = set-rule(|l, k, [v | &lt;lookup-rule(|l, k, v) &lt;+ ![]&gt;])</span><span style="color: rgb(63, 127, 95)"></code>
<code id="921"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="922"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="923"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-add-fail</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="924"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="925"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-fail</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="926"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"></code>
<code id="927"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="928"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-rm-fail</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="929"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"></code>
<code id="930"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="931"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">add</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 64, 128)"></code>
<code id="932"></span><span style="color: rgb(0, 64, 128)">             </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="933"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="934"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="935"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="936"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="937"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-push</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="938"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">add</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="939"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="940"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="941"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">add1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 64, 128)"></code>
<code id="942"></span><span style="color: rgb(0, 64, 128)">             </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="943"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="944"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="945"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">add2</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="946"></span><span style="color: rgb(0, 64, 128)">              </span><span style="color: rgb(0, 64, 128)">add1</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="947"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)">  // this is when the hash table of the change</span><span style="color: rgb(63, 127, 95)"></code>
<code id="948"></span><span style="color: rgb(63, 127, 95)">                           // set already contains a binding for the key</span><span style="color: rgb(63, 127, 95)"></code>
<code id="949"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(63, 127, 95)"></code>
<code id="950"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="951"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="952"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="953"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="954"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="955"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="956"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="957"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="958"></span><span style="color: rgb(63, 127, 95)">                           // this is when the hash table of the change set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="959"></span><span style="color: rgb(63, 127, 95)">                           // already does not already contain a binding for the key</span><span style="color: rgb(63, 127, 95)"></code>
<code id="960"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="961"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="962"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="963"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="964"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="965"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">add2</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="966"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="967"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">add2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="968"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="969"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="970"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="971"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="972"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="973"></span><span style="color: rgb(63, 127, 95)">   * add a rule to the scope for label such that it is visible afterwards</span><span style="color: rgb(63, 127, 95)"></code>
<code id="974"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="975"></span><span style="color: rgb(63, 127, 95)">   * @assert: dr-add-to-rule-set(|l, k, v)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="976"></span><span style="color: rgb(63, 127, 95)">   *               = set-rule(|l, k, [v | &lt;lookup-rule(|l, k, v) &lt;+ ![]&gt;])</span><span style="color: rgb(63, 127, 95)"></code>
<code id="977"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="978"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="979"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-add-fail</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-rm-fail</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="980"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="981"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)"></code>
<code id="982"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 0, 0)">add</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="983"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 0)">rm</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 64, 128)"></code>
<code id="984"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"></code>
<code id="985"></span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="986"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="987"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="988"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 64, 128)">add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="989"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-push</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="990"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="991"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">rm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="992"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">add</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">rm</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="993"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="994"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="995"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="996"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set-vis</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)"></code>
<code id="997"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 0, 0)">add1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="998"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 0)">rm1</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(0, 64, 128)"></code>
<code id="999"></span><span style="color: rgb(0, 64, 128)">      </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1000"></span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1001"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1002"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">add2</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1003"></span><span style="color: rgb(0, 64, 128)">              </span><span style="color: rgb(0, 64, 128)">add1</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1004"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)">  // this is when the hash table of the change</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1005"></span><span style="color: rgb(63, 127, 95)">                           // set already contains a binding for the key</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1006"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1007"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1008"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1009"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1010"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1011"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1012"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1013"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1014"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1015"></span><span style="color: rgb(63, 127, 95)">                           // this is when the hash table of the change set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1016"></span><span style="color: rgb(63, 127, 95)">                           // already does not already contain a binding for the key</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1017"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1018"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1019"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1020"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">rm2</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1021"></span><span style="color: rgb(0, 64, 128)">              </span><span style="color: rgb(0, 64, 128)">rm1</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1022"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1023"></span><span style="color: rgb(63, 127, 95)">                   </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1024"></span><span style="color: rgb(63, 127, 95)">                   </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1025"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1026"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1027"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-contains</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1028"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1029"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">add2</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">hptr</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1030"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1031"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-add-to-rule-set-vis</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">add2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">rm2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1032"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1033"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1034"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1035"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1036"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // intersection and union of rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1037"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1038"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1039"></span><span style="color: rgb(63, 127, 95)">   * Merge two rule sets scope by scope.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1040"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1041"></span><span style="color: rgb(63, 127, 95)">   * @merge-rs : operation to merge RuleScopes</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1042"></span><span style="color: rgb(63, 127, 95)">   * @merge-cs : operation to merge ChangeSets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1043"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1044"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1045"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge-rs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">merge-cs</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1046"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">rec</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1047"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1048"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets1</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge-rs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">x</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1049"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets2</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge-cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">x</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1050"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1051"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1052"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets1</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge-rs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">merge-rec</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1053"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labels1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1a</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1054"></span><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labels2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2a</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1055"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1056"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">ior</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge-rs</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge-rec</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1a</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2a</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1057"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1058"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets2</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge-cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">merge-rec</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1059"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs1</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labels1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1a</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1060"></span><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs2</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labels2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2a</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1a</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1061"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1062"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1063"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;ignore&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">slabel1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1064"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;ignore&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">slabel2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1065"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1066"></span><span style="color: rgb(63, 127, 95)">      // if one branch had a break and one had a continue,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1067"></span><span style="color: rgb(63, 127, 95)">      // we need to propagate the effect of continue (the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1068"></span><span style="color: rgb(63, 127, 95)">      // &quot;milder&quot; of the two) in terms of marking the change</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1069"></span><span style="color: rgb(63, 127, 95)">      // set as ignored</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1070"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1071"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lb1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1072"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lc2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1073"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">.</span><span style="color: rgb(0, 0, 0)">lb1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1074"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lc2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1075"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1076"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1077"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lb2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1078"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lc1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1079"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">.</span><span style="color: rgb(0, 0, 0)">lb2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1080"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lc1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1081"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1082"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1083"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)">// &quot;ignore&quot; &amp; &quot;ignore&quot; have to be merged, with the &quot;ignore&quot; system label kept</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1084"></span><span style="color: rgb(63, 127, 95)">         // &quot;&quot; &amp; &quot;&quot; is the normal merge</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1085"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">slabel1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">slabel2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1086"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">ior</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge-cs</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge-rec</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1a</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2a</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1087"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">cs1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1088"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1089"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1090"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1091"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1092"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1093"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lb</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1094"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lb</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1095"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1096"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1097"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lc</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1098"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csid1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lc</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1099"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1100"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1101"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1a</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2a</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1102"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">slabel1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;ignore&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> // slabel1 = &quot;ignore&quot; &amp; slabel2 != &quot;ignore&quot;, so we ignore cs1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1103"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">cs2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1104"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">slabel2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;ignore&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> // slabel1 != &quot;ignore&quot; &amp; slabel2 = &quot;ignore&quot;, so we ignore cs2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1105"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">cs1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1106"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1107"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;Merging of rulesets cannot continue because the non-ingnored change set is based on a different ruleset than the ignored change set.&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1108"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1109"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1110"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1111"></span><span style="color: rgb(63, 127, 95)">   * Fixes references in change set that point to rule scopes that will</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1112"></span><span style="color: rgb(63, 127, 95)">   * no longer be part of the merged ruleset. It is assumed that the references</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1113"></span><span style="color: rgb(63, 127, 95)">   * that point to rule scopes in rsbad have to be replaced with references to</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1114"></span><span style="color: rgb(63, 127, 95)">   * the corresponding (according to position) rule scopes in rsgood.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1115"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1116"></span><span style="color: rgb(63, 127, 95)">   * No longer used.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1117"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1118"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-change-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1119"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rsgood</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rsbad</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1120"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rsgood</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsgood_</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1121"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rsgood</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsbad_</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1122"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1123"></span><span style="color: rgb(63, 127, 95)">        // only do this if it is indeed the case</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1124"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpidsgood_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsbad_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1125"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1126"></span><span style="color: rgb(63, 127, 95)">            // sanity check</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1127"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">length</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">scpidsgood_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">length</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">scpidsbad_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1128"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;Expected structurally matching rule sets!&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1129"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1130"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1131"></span><span style="color: rgb(63, 127, 95)">        // some part of the rule sets might still be equal. Eliminate that</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1132"></span><span style="color: rgb(63, 127, 95)">        // part from both lists to avoid needless fixing</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1133"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eliminate-common-suffix</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpidsgood_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsbad_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpidsgood</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsbad</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1134"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1135"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1136"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idx</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1137"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1138"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1139"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">get-index</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsbad</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idx</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1140"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1141"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">index</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">idx</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsgood</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1142"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1143"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1144"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1145"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idx</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1146"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1147"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1148"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">get-index</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsbad</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idx</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1149"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1150"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1151"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">index</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">idx</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpidsgood</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1152"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1153"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1154"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1155"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1156"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1157"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1158"></span><span style="color: rgb(63, 127, 95)">   * Intersection of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1159"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1160"></span><span style="color: rgb(63, 127, 95)">   * assumption: the scope structure is the same</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1161"></span><span style="color: rgb(63, 127, 95)">   * intersection works scope by scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1162"></span><span style="color: rgb(63, 127, 95)">   * note that labels are ignored</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1163"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1164"></span><span style="color: rgb(63, 127, 95)">   * @todo: intersect labelsets as well!!??</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1165"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1166"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1167"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-intersect-rule-sets</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1168"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1169"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1170"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-intersect-wempty</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1171"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1172"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">apply-rm-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1173"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1174"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-intersect-wempty</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1175"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1176"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1177"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">apply-rm-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1178"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1179"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1180"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1181"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1182"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1183"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1184"></span><span style="color: rgb(63, 127, 95)">   * Symmetric intersection of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1185"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1186"></span><span style="color: rgb(63, 127, 95)">   * assumption: the scope structure is the same</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1187"></span><span style="color: rgb(63, 127, 95)">   * intersection works scope by scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1188"></span><span style="color: rgb(63, 127, 95)">   * note that labels are ignored</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1189"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1190"></span><span style="color: rgb(63, 127, 95)">   * @todo: intersect labelsets as well!!</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1191"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1192"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1193"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-intersect-rule-sets-symm</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1194"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1195"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1196"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-intersect-symm-wempty</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1197"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1198"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">apply-rm-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1199"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">apply-rm-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1200"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1201"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1202"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-intersect-symm-wempty-ignore-left</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1203"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1204"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1205"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1206"></span><span style="color: rgb(63, 127, 95)">   * Union of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1207"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1208"></span><span style="color: rgb(63, 127, 95)">   * assumption: the scope structure of the two rule-sets is the same</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1209"></span><span style="color: rgb(63, 127, 95)">   * and union works scope by scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1210"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1211"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1212"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1213"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-union-rule-sets</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1214"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1215"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1216"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1217"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1218"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1219"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">apply-rm-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1220"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1221"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1222"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">symmetric-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1223"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">iterate1-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1224"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1225"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1226"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">union</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1227"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1228"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1229"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1230"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1231"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1232"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1233"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-union-rule-sets-symm</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1234"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-merge-rule-sets</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1235"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1236"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-union-symm-wempty</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1237"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1238"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1239"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">apply-rm-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1240"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">apply-rm-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1241"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1242"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-union</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1243"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(63, 127, 95)"></code>
<code id="1244"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1245"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">symmetric-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1246"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">iterate1-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1247"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1248"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1249"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">union</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1250"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1251"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">change1-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1252"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 64, 128)">change2-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1253"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1254"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1255"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1256"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1257"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1258"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // generic fork-and-merge strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1259"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1260"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">fork-rule-sets</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1261"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1262"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1263"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1264"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1265"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1266"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">merge-rule-sets</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1267"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1268"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1269"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1270"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1271"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1272"></span><span style="color: rgb(63, 127, 95)">   * Fork and merge two rule-sets.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1273"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1274"></span><span style="color: rgb(63, 127, 95)">   * @param merge :</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1275"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1276"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1277"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fork-and-merge</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s2</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1278"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fork-rule-sets</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1279"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1280"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 64, 128)">dr-switch-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1281"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1282"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge-rule-sets</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1283"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1284"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fork-and-merge</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">merge2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s2</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1285"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1286"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fork-rule-sets</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1a</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1287"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fork-rule-sets</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1b</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1288"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1289"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1290"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1291"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1292"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1293"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1294"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1295"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1296"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1297"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 64, 128)">dr-switch-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1a</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2a</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1298"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 64, 128)">dr-switch-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1b</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2b</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1299"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1300"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1301"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">s2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1302"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1303"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1304"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1305"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1306"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1307"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1308"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge-rule-sets</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2a</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1309"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge-rule-sets</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2b</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1310"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1311"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1312"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // generic fix-point strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1313"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1314"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1315"></span><span style="color: rgb(63, 127, 95)">   * Iterate and merge two rule-sets.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1316"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1317"></span><span style="color: rgb(63, 127, 95)">   * @param merge :</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1318"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1319"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1320"></span><span style="color: rgb(63, 127, 95)">/*</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1321"></span><span style="color: rgb(63, 127, 95)"> * the old implementation (for reference)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1322"></span><span style="color: rgb(63, 127, 95)"> *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1323"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1324"></span><span style="color: rgb(63, 127, 95)">  dr-fix-and-merge-no-break(merge, s | rulenames) =</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1325"></span><span style="color: rgb(63, 127, 95)">    where(&lt;map(fork-rule-sets)&gt; rulenames =&gt; rs)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1326"></span><span style="color: rgb(63, 127, 95)">    ; repeat(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1327"></span><span style="color: rgb(63, 127, 95)">        where(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1328"></span><span style="color: rgb(63, 127, 95)">          restore(s, where(&lt;map(dr-discard-change-set(|&lt;id&gt;))&gt; rulenames))</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1329"></span><span style="color: rgb(63, 127, 95)">          ; if &lt;filter({?(rulename,&lt;id&gt;); &lt;merge&gt;(rulename, &lt;id&gt;)})&gt; rs; []</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1330"></span><span style="color: rgb(63, 127, 95)">            then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1331"></span><span style="color: rgb(63, 127, 95)">              ?e; fail // no changes in any of the rules</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1332"></span><span style="color: rgb(63, 127, 95)">            else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1333"></span><span style="color: rgb(63, 127, 95)">              id       // some rule changed; continue</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1334"></span><span style="color: rgb(63, 127, 95)">            end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1335"></span><span style="color: rgb(63, 127, 95)">        )</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1336"></span><span style="color: rgb(63, 127, 95)">      )</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1337"></span><span style="color: rgb(63, 127, 95)">    ; !e</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1338"></span><span style="color: rgb(63, 127, 95)">    ; where(&lt;map(dr-commit-change-set(|&lt;id&gt;))&gt; rulenames)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1339"></span><span style="color: rgb(63, 127, 95)">*/</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1340"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1341"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1342"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1343"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1344"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1345"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge-internal</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1346"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1347"></span><span style="color: rgb(63, 127, 95)">  // notes:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1348"></span><span style="color: rgb(63, 127, 95)">  //  - keep just the last cs's from dr-break</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1349"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge-internal</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1350"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fork-rule-sets</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1351"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1352"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_get&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-rule-sets-hashtable</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;DR_EXCEPTION&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1353"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-getlist</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labels</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1354"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 128, 0)">0</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">exRS</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1355"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 128, 0)">1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">exRS</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1356"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1357"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">repeat</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1358"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1359"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1360"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1361"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1362"></span><span style="color: rgb(63, 127, 95)">                 // getting a change set marked as ignored here means that the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1363"></span><span style="color: rgb(63, 127, 95)">                 // loop _always_ ends with a break, so we might as well not have</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1364"></span><span style="color: rgb(63, 127, 95)">                 // had a loop at all, since it will only be executed once</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1365"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1366"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1367"></span><span style="color: rgb(63, 127, 95)">                   </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1368"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1369"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1370"></span><span style="color: rgb(63, 127, 95)">                   </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1371"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-merge-continue-change-sets</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1372"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1373"></span><span style="color: rgb(63, 127, 95)">                   </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1374"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1375"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1376"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no changes in any of the rule sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1377"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1378"></span><span style="color: rgb(63, 127, 95)">              // further down below, we need to be able to extract the elements</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1379"></span><span style="color: rgb(63, 127, 95)">              // in the list returned by bagof-DR_BREAK which were defined during</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1380"></span><span style="color: rgb(63, 127, 95)">              // the first run (from above) of the strategy s and the ones in the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1381"></span><span style="color: rgb(63, 127, 95)">              // last run. For this, we need to make sure there will be some</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1382"></span><span style="color: rgb(63, 127, 95)">              // separators in that list which we can use to get what we need.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1383"></span><span style="color: rgb(63, 127, 95)">              // The separator will be (), and here is the point where we add it</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1384"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1385"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1386"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1387"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">BreakCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1388"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1389"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1390"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">exRS</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 128, 0)">0</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1391"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-new-rule-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1392"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">iset-addlist</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">labels</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-putlist</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1393"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;DR_EXCEPTION&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1394"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1395"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(63, 127, 95)">     // some rule changed; continue</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1396"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1397"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1398"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1399"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1400"></span><span style="color: rgb(63, 127, 95)">    // we only want to use those elements from bagof-DR_BREAK that are from</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1401"></span><span style="color: rgb(63, 127, 95)">    // the first and the last run of strategy s in the repeat from above.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1402"></span><span style="color: rgb(63, 127, 95)">    // For that, we used () as a separator (see comment above). Here we make</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1403"></span><span style="color: rgb(63, 127, 95)">    // sure that when bagof-DR_BREAK is called in dr-label, only the proper</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1404"></span><span style="color: rgb(63, 127, 95)">    // change sets are returned for merging</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1405"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1406"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1407"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1408"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">BreakCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1409"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">list-tokenize</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1410"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">first-last</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1411"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">concat</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1412"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">BreakCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1413"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">reverse-map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">BreakCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1414"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1415"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1416"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1417"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1418"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1419"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">merge2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1420"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fork-rule-sets</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1421"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">fork-rule-sets</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1422"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">repeat</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1423"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1424"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1425"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1426"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1427"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1428"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1429"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1430"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1431"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">and</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge1</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1432"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge2</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs2</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1433"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1434"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no changes in any of the rules</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1435"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1436"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1437"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1438"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1439"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1440"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1441"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1442"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-merge-continue-change-sets</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1443"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1444"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1445"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">ContinueCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1446"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ContinueCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1447"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1448"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1449"></span><span style="color: rgb(63, 127, 95)">        // discard and replace the current change set with the first</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1450"></span><span style="color: rgb(63, 127, 95)">        // one from the list returned by bagof-DR_BREAK (it could have</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1451"></span><span style="color: rgb(63, 127, 95)">        // been any other element of that list just as well)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1452"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1453"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">Tl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1454"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1455"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1456"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1457"></span><span style="color: rgb(63, 127, 95)">    // merge all the change sets (prepended to the common part of the ruleset)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1458"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1459"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1460"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // labeling statements, break, continue</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1461"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1462"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1463"></span><span style="color: rgb(63, 127, 95)">   * @todo destroy the change sets introduced by calls to dr-break</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1464"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1465"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-label</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1466"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">{|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">DR_BREAK</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1467"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1468"></span><span style="color: rgb(63, 127, 95)">      // register &lt;label&gt; as the active label</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1469"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1470"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1471"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1472"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1473"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1474"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1475"></span><span style="color: rgb(63, 127, 95)">      // for each rule r in &lt;rulenames&gt; define a dynamic rule which</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1476"></span><span style="color: rgb(63, 127, 95)">      // marks the position of the change set created below in the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1477"></span><span style="color: rgb(63, 127, 95)">      // ruleset of r</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1478"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1479"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1480"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1481"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1482"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">length</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1483"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">SplitPos</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1484"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1485"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1486"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1487"></span><span style="color: rgb(63, 127, 95)">      // we need a change set to collect all the changes</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1488"></span><span style="color: rgb(63, 127, 95)">      // to the rule set which are created on control flow</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1489"></span><span style="color: rgb(63, 127, 95)">      // paths that do not end with a call to dr-break or</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1490"></span><span style="color: rgb(63, 127, 95)">      // dr-continue</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1491"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1492"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1493"></span><span style="color: rgb(63, 127, 95)">      // run the strategy and save the result</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1494"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1495"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1496"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1497"></span><span style="color: rgb(63, 127, 95)">      // for each rule r in &lt;rulenames&gt; we essentially want to merge the current</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1498"></span><span style="color: rgb(63, 127, 95)">      // ruleset for rule r with the change sets for r and the current &lt;label&gt;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1499"></span><span style="color: rgb(63, 127, 95)">      // returned by bagof-DR_BREAK (prepended to the common part of the ruleset)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1500"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">csidnew</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cslbl</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1501"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1502"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1503"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">BreakCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1504"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1505"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1506"></span><span style="color: rgb(63, 127, 95)">              // discard replace the current change set with the first one from the list</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1507"></span><span style="color: rgb(63, 127, 95)">              // returned by bagof-DR_BREAK (it could have been any other element of that</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1508"></span><span style="color: rgb(63, 127, 95)">              // list just as well)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1509"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1510"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">Tl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1511"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1512"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1513"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1514"></span><span style="color: rgb(63, 127, 95)">          // merge all the change sets (prepended to the common part of the ruleset)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1515"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1516"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1517"></span><span style="color: rgb(63, 127, 95)">          // commit the change sets created above</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1518"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1519"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1520"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1521"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1522"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">|}</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1523"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1524"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-break</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1525"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-break</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1526"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1527"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-break</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1528"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1529"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1530"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1531"></span><span style="color: rgb(63, 127, 95)">      // split the ruleset in two parts: the one before the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1532"></span><span style="color: rgb(63, 127, 95)">      // labeled statement and the one after it</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1533"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">back-split-at</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">SplitPos</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1534"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1535"></span><span style="color: rgb(63, 127, 95)">      // build the change set with all the changes from</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1536"></span><span style="color: rgb(63, 127, 95)">      // the first part of the pair generated above...</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1537"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-build-aggregated-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">bcs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1538"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1539"></span><span style="color: rgb(63, 127, 95)">      // ... and add it to the rule which collects all</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1540"></span><span style="color: rgb(63, 127, 95)">      // the change sets pertaining to control flow paths</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1541"></span><span style="color: rgb(63, 127, 95)">      // that lead to a break</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1542"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">.</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">BreakCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">bcs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1543"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1544"></span><span style="color: rgb(63, 127, 95)">      // go back to the active ruleset and mark the innermost change set as ignored</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1545"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1546"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1547"></span><span style="color: rgb(63, 127, 95)">//      ; rules(DR_BREAK.label : IgnoreB(csid) -&gt; label)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1548"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1549"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1550"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1551"></span><span style="color: rgb(63, 127, 95)">/**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1552"></span><span style="color: rgb(63, 127, 95)">  * This implementation of the strategy doesn't work.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1553"></span><span style="color: rgb(63, 127, 95)">  * (left here for reference purposes only)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1554"></span><span style="color: rgb(63, 127, 95)">  *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1555"></span><span style="color: rgb(63, 127, 95)">  * Reason: replacing a number of change sets &amp; rule scopes with</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1556"></span><span style="color: rgb(63, 127, 95)">  *         their clones introduces inconsistency issues during merging</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1557"></span><span style="color: rgb(63, 127, 95)">  *         that are way too difficult to solve.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1558"></span><span style="color: rgb(63, 127, 95)">  *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1559"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1560"></span><span style="color: rgb(63, 127, 95)">  dr-break-bp(|rulename) =</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1561"></span><span style="color: rgb(63, 127, 95)">    where(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1562"></span><span style="color: rgb(63, 127, 95)">      &lt;DR_BREAK&gt;Label(rulename) =&gt; label</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1563"></span><span style="color: rgb(63, 127, 95)">      ; dr-get-rule-set(|rulename)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1564"></span><span style="color: rgb(63, 127, 95)">      ; back-split-at(|&lt;DR_BREAK&gt;SplitPos(rulename, label))</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1565"></span><span style="color: rgb(63, 127, 95)">      ; ?(inRs, outRs)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1566"></span><span style="color: rgb(63, 127, 95)">      ; &lt;map({scope, lbls :</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1567"></span><span style="color: rgb(63, 127, 95)">          (?ChangeSet(_, _, _); dr-new-change-set)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1568"></span><span style="color: rgb(63, 127, 95)">          &lt;+ \ RuleScope(labels, table) -&gt; scope</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1569"></span><span style="color: rgb(63, 127, 95)">                 where dr-new-scope =&gt; scope@RuleScope(lbls, tbl)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1570"></span><span style="color: rgb(63, 127, 95)">                       ; &lt;iset-addlist(|&lt;iset-elements&gt;labels)&gt;lbls</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1571"></span><span style="color: rgb(63, 127, 95)">                       ; &lt;hashtable-keys&gt;table </span><span style="color: rgb(63, 127, 95)"></code>
<code id="1572"></span><span style="color: rgb(63, 127, 95)">                       ; map({key, val :</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1573"></span><span style="color: rgb(63, 127, 95)">                           ?key</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1574"></span><span style="color: rgb(63, 127, 95)">                           ; &lt;hashtable-get(|key)&gt;table =&gt; val</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1575"></span><span style="color: rgb(63, 127, 95)">                           ; &lt;hashtable-put(|key, val)&gt;tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1576"></span><span style="color: rgb(63, 127, 95)">                         }) \</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1577"></span><span style="color: rgb(63, 127, 95)">        })&gt;inRs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1578"></span><span style="color: rgb(63, 127, 95)">      ; &lt;conc&gt;(&lt;id&gt;, outRs)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1579"></span><span style="color: rgb(63, 127, 95)">      ; dr-set-rule-set(|rulename)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1580"></span><span style="color: rgb(63, 127, 95)">    )</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1581"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1582"></span><span style="color: rgb(63, 127, 95)">*/</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1583"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1584"></span><span style="color: rgb(63, 127, 95)">  // dr-break version for backward propagation transformations</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1585"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-break-bp</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1586"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1587"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1588"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1589"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">back-split-at</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">SplitPos</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1590"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(63, 127, 95)"></code>
<code id="1591"></span><span style="color: rgb(63, 127, 95)">      // here we make the assumption that we always have a</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1592"></span><span style="color: rgb(63, 127, 95)">      // change set as the first element in the rule set,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1593"></span><span style="color: rgb(63, 127, 95)">      // which comes from the assumption that the user always</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1594"></span><span style="color: rgb(63, 127, 95)">      // uses dr-transaction with rule scopes in backward</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1595"></span><span style="color: rgb(63, 127, 95)">      // propagation transformations</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1596"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">inRs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">outRs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1597"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-clear</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1598"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-clear</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1599"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">reverse</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">inRs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1600"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-build-bp-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">outRs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1601"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1602"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1603"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-build-bp-change-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1604"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-build-bp-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1605"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1606"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1607"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-build-bp-change-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1608"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rest</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1609"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1610"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1611"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1612"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1613"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1614"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1615"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1616"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1617"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1618"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1619"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1620"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-lookup-rule-in-scope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1621"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1622"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-add</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1623"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1624"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-build-bp-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ruleset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rest</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1625"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1626"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-continue</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1627"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-continue</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1628"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1629"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-continue</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1630"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1631"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1632"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1633"></span><span style="color: rgb(63, 127, 95)">      // split the ruleset in two parts: the one before the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1634"></span><span style="color: rgb(63, 127, 95)">      // labeled statement and the one after it</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1635"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">back-split-at</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">SplitPos</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1636"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1637"></span><span style="color: rgb(63, 127, 95)">      // build the change set with all the changes from</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1638"></span><span style="color: rgb(63, 127, 95)">      // the first part of the pair generated above...</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1639"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-build-aggregated-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ccs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1640"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1641"></span><span style="color: rgb(63, 127, 95)">      // ... and add it to the rule which collects all</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1642"></span><span style="color: rgb(63, 127, 95)">      // the change sets pertaining to control flow paths</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1643"></span><span style="color: rgb(63, 127, 95)">      // that lead to a continue</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1644"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">.</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ContinueCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ccs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1645"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1646"></span><span style="color: rgb(63, 127, 95)">      // go back to the active ruleset and mark the innermost change set as ignored</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1647"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1648"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1649"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1650"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1651"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1652"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1653"></span><span style="color: rgb(63, 127, 95)">   * This strategy takes a pair of lists of change sets and rule scopes</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1654"></span><span style="color: rgb(63, 127, 95)">   * and returns a change set which contains all the changes from the</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1655"></span><span style="color: rgb(63, 127, 95)">   * change sets in the left member of the input pair which refer to</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1656"></span><span style="color: rgb(63, 127, 95)">   * rule scopes in the right member of the input pair.</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1657"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1658"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-build-aggregated-change-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1659"></span><span style="color: rgb(0, 64, 128)"></code>
<code id="1660"></span><span style="color: rgb(0, 64, 128)">    // create the extra change set</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1661"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">sourceRs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">aggCs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1662"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1663"></span><span style="color: rgb(63, 127, 95)">    // commit all change sets in sourceRs to the extra change set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1664"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">reverse-map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1665"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1666"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1667"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">sourceRs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1668"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1669"></span><span style="color: rgb(63, 127, 95)">    // collect all the scope ids of the rule scopes in sourceRs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1670"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">sourceRs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpids</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1671"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1672"></span><span style="color: rgb(63, 127, 95)">    // remove all the elements from rmset that refer to rule scopes</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1673"></span><span style="color: rgb(63, 127, 95)">    // whose scope id is part of scpids</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1674"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1675"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1676"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1677"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">scpids</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1678"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1679"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1680"></span><span style="color: rgb(63, 127, 95)">    // remove all the elements from tbl that refer to rule scopes</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1681"></span><span style="color: rgb(63, 127, 95)">    // whose scope id is part of scpids</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1682"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1683"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1684"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1685"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">scpid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">scpids</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1686"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1687"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1688"></span><span style="color: rgb(63, 127, 95)">    // return the built change set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1689"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">aggCs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1690"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1691"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // exception handling strategies</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1692"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1693"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-init-exception-block</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">has-finally</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">catch-tags</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1694"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1695"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1696"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1697"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">length</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1698"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1699"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">catch-tags</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1700"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">has-finally</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">new</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1701"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1702"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1703"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1704"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1705"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-throw</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">eq-test</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tag</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1706"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1707"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">get-matching-id</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">eq-test</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tag</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1708"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1709"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">back-split-at</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1710"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-build-aggregated-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tcs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1711"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tcs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1712"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1713"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1714"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1715"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1716"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">get-matching-id</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">eq-test</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tag</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1717"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1718"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1719"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1720"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1721"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ctag</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ctag</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq-test</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tag</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ctag</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1722"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1723"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-throw: Thrown exception does not match any catch clause&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1724"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1725"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1726"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1727"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ctag</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ctag</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq-test</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tag</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ctag</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1728"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1729"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1730"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1731"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1732"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">get-matching-id</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1733"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1734"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1735"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1736"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fetch-elem</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1737"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1738"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1739"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1740"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-finally: Could not forward exception due to missing catch clause&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1741"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1742"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-catch</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1743"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">term</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1744"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1745"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1746"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1747"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1748"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-catch was called when no catch clause was active or when a finished exception block was not completed&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1749"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1750"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-catch was not called in a proper exception handling context&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1751"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1752"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1753"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-clone-change-set</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1754"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1755"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1756"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-clone-change-set</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1757"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1758"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1759"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">css</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1760"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1761"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">term</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1762"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">zip</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">css</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1763"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1764"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1765"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1766"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">dr-destroy-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1767"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1768"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1769"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1770"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1771"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1772"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">zip</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">css</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1773"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fin</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs'</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1774"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1775"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">once-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">Catch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fin</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1776"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-catch: Unexpected failure here!&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1777"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catches</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fin</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1778"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1779"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs'</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1780"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-catch: A change set was expected here!&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1781"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1782"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ExceptionCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1783"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ExceptionCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs'</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1784"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1785"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1786"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1787"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1788"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1789"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1790"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-finally</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1791"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">term</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1792"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(63, 127, 95)"></code>
<code id="1793"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tcss</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1794"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1795"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">once-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1796"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-finally was called when a catch clause was still active&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1797"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-finally was called when a finally clause was not active&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1798"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1799"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-finally was not called in a proper exception handling context&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1800"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tcss</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1801"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">ExceptionCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1802"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">conc</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tcss</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1803"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1804"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1805"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-clone-change-set</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1806"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1807"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1808"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-clone-change-set</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1809"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1810"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1811"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1812"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">temp</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1813"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1814"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">term</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1815"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1816"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1817"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1818"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">dr-destroy-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1819"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">cs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1820"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1821"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tb</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1822"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">temp</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1823"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1824"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1825"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1826"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1827"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1828"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ExceptionCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1829"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1830"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-finally: A change set was expected here!&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1831"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1832"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1833"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1834"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1835"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">make-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1836"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">nextID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tcs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1837"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1838"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">get-matching-id</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">nextID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1839"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">back-split-at</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">pos</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1840"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-build-aggregated-change-set</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tcs</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1841"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">nextID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tcs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">catchID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1842"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1843"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1844"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ThrowCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">fID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1845"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">temp</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1846"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1847"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">e</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1848"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1849"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-exception-block</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1850"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1851"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1852"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1853"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">once-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">Structure</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">TryBlock</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1854"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-exception-block was called before completing all catch clauses (and the finally clause) or in a non-proper exception handling context&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1855"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1856"></span><span style="color: rgb(63, 127, 95)">           </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">fatal-err</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 255)">&quot;dr-complete-exception-block was not called in a proper exception handling context&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1857"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">bagof-DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">ExceptionCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1858"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1859"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1860"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-clone-change-set</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1861"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1862"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1863"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1864"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1865"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:-</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ExceptionCS</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ID</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1866"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1867"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1868"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1869"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1870"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // transactional run of a strategy</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1871"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1872"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-transaction</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1873"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1874"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">restore</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-discard-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1875"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1876"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1877"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // fork with intersection and union</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1878"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1879"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1880"></span><span style="color: rgb(63, 127, 95)">   * two-way split in data-flow (if-then-else) for list of rules</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1881"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1882"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1883"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1884"></span><span style="color: rgb(63, 127, 95)">   * Fork and intersection of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1885"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1886"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fork-and-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s2</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1887"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fork-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1888"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1889"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1890"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1891"></span><span style="color: rgb(63, 127, 95)">   * Fork and union of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1892"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1893"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fork-and-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s2</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1894"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fork-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1895"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1896"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1897"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1898"></span><span style="color: rgb(63, 127, 95)">   * Fork and combined union and intersection of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1899"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1900"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fork-and-intersect-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">s2</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1901"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fork-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1902"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1903"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1904"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1905"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // fix-point with intersection and union</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1906"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1907"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1908"></span><span style="color: rgb(63, 127, 95)">   * loop in data-flow (while)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1909"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1910"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1911"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1912"></span><span style="color: rgb(63, 127, 95)">   * Iterate intersection of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1913"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1914"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1915"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-symm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1916"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1917"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1918"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1919"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-symm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1920"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1921"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1922"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1923"></span><span style="color: rgb(63, 127, 95)">   * Iterate union of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1924"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1925"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1926"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-symm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1927"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1928"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1929"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1930"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-symm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1931"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1932"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1933"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1934"></span><span style="color: rgb(63, 127, 95)">   * Iterate combined union and intersection of two rule-sets</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1935"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1936"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fix-and-intersect-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1937"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-fix-and-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-symm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1938"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-symm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1939"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1940"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1941"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // label statements with intersection and union</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1942"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1943"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1944"></span><span style="color: rgb(63, 127, 95)">   * labeled _non-iterative_ statement in data-flow</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1945"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1946"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1947"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1948"></span><span style="color: rgb(63, 127, 95)">   * Label current point in data-flow with &lt;label&gt; to accommodate</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1949"></span><span style="color: rgb(63, 127, 95)">   * break's. Intersection of rule-sets after running &lt;s&gt;:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1950"></span><span style="color: rgb(63, 127, 95)">   *   - the &quot;main&quot; rule-set resulted by running &lt;s&gt;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1951"></span><span style="color: rgb(63, 127, 95)">   *   - all the rule-sets generated by calls to dr-break</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1952"></span><span style="color: rgb(63, 127, 95)">   *     with the same label as this one</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1953"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1954"></span><span style="color: rgb(63, 127, 95)">   * !! Only use this to label non-iterative statements. !!</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1955"></span><span style="color: rgb(63, 127, 95)">   * !! Use dr-fix-and-intersect which takes a label     !! </span><span style="color: rgb(63, 127, 95)"></code>
<code id="1956"></span><span style="color: rgb(63, 127, 95)">   * !! argument to label iterative statements.          !!</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1957"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1958"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-label-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1959"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-symm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1960"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1961"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1962"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1963"></span><span style="color: rgb(63, 127, 95)">   * Label current point in data-flow with &lt;label&gt; to accommodate</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1964"></span><span style="color: rgb(63, 127, 95)">   * break's. Union of rule-sets after running &lt;s&gt;:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1965"></span><span style="color: rgb(63, 127, 95)">   *   - the &quot;main&quot; rule-set resulted by running &lt;s&gt;</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1966"></span><span style="color: rgb(63, 127, 95)">   *   - all the rule-sets generated by calls to dr-break</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1967"></span><span style="color: rgb(63, 127, 95)">   *     with the same label as this one</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1968"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1969"></span><span style="color: rgb(63, 127, 95)">   * !! Only use this to label non-iterative statements. !!</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1970"></span><span style="color: rgb(63, 127, 95)">   * !! Use dr-fix-and-union which takes a label         !! </span><span style="color: rgb(63, 127, 95)"></code>
<code id="1971"></span><span style="color: rgb(63, 127, 95)">   * !! argument to label iterative statements.          !!</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1972"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1973"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-label-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1974"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-label</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-symm</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1975"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1976"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1977"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // exceptions</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1978"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1979"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-catch-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1980"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-complete-catch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1981"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1982"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1983"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-finally-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1984"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-complete-finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1985"></span><span style="color: rgb(63, 127, 95)">                       </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1986"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1987"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-exception-block-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1988"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-complete-exception-block</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-intersect-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1989"></span><span style="color: rgb(63, 127, 95)">                               </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1990"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1991"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1992"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1993"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-catch-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1994"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-complete-catch</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1995"></span><span style="color: rgb(63, 127, 95)">                     </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1996"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="1997"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-finally-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="1998"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-complete-finally</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="1999"></span><span style="color: rgb(63, 127, 95)">                       </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2000"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2001"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-complete-exception-block-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2002"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">dr-complete-exception-block</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-union-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2003"></span><span style="color: rgb(63, 127, 95)">                               </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2004"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2005"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // n-way split</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2006"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2007"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2008"></span><span style="color: rgb(63, 127, 95)">   * n-way split in data-flow (case)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2009"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2010"></span><span style="color: rgb(63, 127, 95)">   * @todo : generalize to factor out table merge operation</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2011"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2012"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2013"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fold-and-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">empty</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2014"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">empty</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2015"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2016"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs0</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2017"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-fold-and-intersect</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">empty</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hd</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs0</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2018"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-commit-change-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2019"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2020"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2021"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-fold-and-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">empty</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">hd</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs0</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2022"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">empty</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2023"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2024"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2025"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2026"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-start-change-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2027"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-set-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs0</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2028"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2029"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hd</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2030"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2031"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2032"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2033"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">tl</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-fold-and-intersect</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">empty</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hd</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs0</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2034"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2035"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-intersect-with</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rulename</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rs1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2036"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2037"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2038"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2039"></span><span style="color: rgb(63, 127, 95)">  /**</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2040"></span><span style="color: rgb(63, 127, 95)">   * fork and intersect over a list</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2041"></span><span style="color: rgb(63, 127, 95)">   *</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2042"></span><span style="color: rgb(63, 127, 95)">   * @todo : generalize to factor out table merge operation</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2043"></span><span style="color: rgb(63, 127, 95)">   */</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2044"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2045"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-map-and-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2046"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">tl</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s'</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s'</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2047"></span><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-fold-and-intersect</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rulenames</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2048"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2049"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2050"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // workaround for overlapping lhhs in dynamic rule</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2051"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2052"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreB</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2053"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">.</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2054"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2055"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreC</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2056"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">.</span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">label</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2057"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2058"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-define-ignoreT</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2059"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DR_EXCEPTION</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">IgnoreT</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2060"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2061"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // rule-set equality</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2062"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2063"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-eq-rule-sets</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2064"></span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">rseq</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2065"></span><span style="color: rgb(0, 64, 128)">        </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">lbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">lbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2066"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-eq</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">lbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2067"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2068"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)">   </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">lbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">lbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2069"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-eq</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">lbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lbl1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2070"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-eq</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">rmset2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset1</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2071"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-eq</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2072"></span><span style="color: rgb(63, 127, 95)">   </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">zip</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">rseq</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2073"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2074"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2075"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // debugging</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2076"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2077"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-debug-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">dr-debug-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2078"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2079"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-debug-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2080"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2081"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">say</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2082"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;Ruleset for: &quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2083"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-print-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2084"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2085"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2086"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-print-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2087"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2088"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2089"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-print-rule-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2090"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2091"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2092"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-print-rule-sets</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2093"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2094"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-print-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2095"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2096"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2097"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-print-rule-set-msg</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2098"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">say</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;\n--- BEGIN(&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 255)">&quot;) ---&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2099"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-print-rule-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2100"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">say</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;--- END  (&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 255)">&quot;) ---\n&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2101"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2102"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-print-rule-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2103"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-print-scope</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2104"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2105"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-print-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2106"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2107"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2108"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2109"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;labels: &quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2110"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2111"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;  &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot; -&gt; &quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2112"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2113"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;    &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2114"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2115"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2116"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2117"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2118"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-print-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2119"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2120"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2121"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2122"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;labels: &quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2123"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;removed: &quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2124"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2125"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;  &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot; -&gt; &quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2126"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2127"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;    &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2128"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2129"></span><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2130"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2131"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">blabel</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2132"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;Change set is marked as ignored (due to break) up to label &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">blabel</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;.&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2133"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2134"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2135"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">clabel</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2136"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;Change set is marked as ignored (due to continue) up to label &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">clabel</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;.&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2137"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2138"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2139"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2140"></span><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // friendlier debugging (numbers instead of ugly strings for hashtable ids)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2141"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2142"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-debug-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">dr-friendly-debug-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2143"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2144"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-debug-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2145"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2146"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">say</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2147"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;Ruleset for: &quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2148"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2149"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2150"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2151"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2152"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2153"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 64, 128)">dr-get-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2154"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2155"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2156"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2157"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-sets</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2158"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2159"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">names</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2160"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2161"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2162"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set-msg</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2163"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">say</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;\n--- BEGIN(&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 255)">&quot;) ---&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2164"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2165"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">say</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;--- END  (&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 255)">&quot;) ---\n&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2166"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2167"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2168"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">DRFriendlyName</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">DR_Count</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2169"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2170"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">DRCount</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;rs&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 128, 0)">0</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2171"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">DRCount</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;cs&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 128, 0)">0</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2172"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2173"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">reverse-map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2174"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rsid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2175"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2176"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DRCount</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 255)">&quot;rs&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idxrs</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">inc</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">idxrs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idxrs'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2177"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;RuleScope(&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">int-to-string</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">idxrs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;)&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2178"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2179"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2180"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 64, 128)">DRFriendlyName</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rsid</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2181"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 64, 128)">DRCount</span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;rs&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idxrs'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2182"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2183"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2184"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2185"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DRCount</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 255)">&quot;cs&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idxcs</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">inc</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">idxcs</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idxcs'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2186"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;ChangeSet(&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">int-to-string</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">idxcs</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;)&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2187"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2188"></span><span style="color: rgb(63, 127, 95)">             </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">rules</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2189"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 64, 128)">DRFriendlyName</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2190"></span><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 64, 128)">DRCount</span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;cs&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">idxcs'</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2191"></span><span style="color: rgb(63, 127, 95)">               </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2192"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2193"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">dr-friendly-print-scope</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2194"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">|}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2195"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2196"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set-msg</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2197"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">say</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;\n--- BEGIN(&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 255)">&quot;) ---&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2198"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-rule-set</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2199"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;&quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">say</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">concat-strings</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;--- END  (&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">msg</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 255)">&quot;) ---\n&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2200"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2201"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2202"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">RuleScope</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">rsid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2203"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DRFriendlyName</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">rsid</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2204"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2205"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2206"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;labels: &quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2207"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2208"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2209"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;  &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot; -&gt; &quot;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2210"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2211"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2212"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;    &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2213"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2214"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2215"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2216"></span><span style="color: rgb(63, 127, 95)"></code>
<code id="2217"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">dr-friendly-print-scope</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"></code>
<code id="2218"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">ChangeSet</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">@</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2219"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DRFriendlyName</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2220"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2221"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2222"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;labels: &quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">labelset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2223"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">iset-elements</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">debug</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 255)">&quot;removed: &quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">rmset</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2224"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2225"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2226"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">DRFriendlyName</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;  &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot; -&gt; &quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2227"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2228"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2229"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;    &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2230"></span><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2231"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2232"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2233"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreB</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">blabel</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2234"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;Change set is marked as ignored (due to break) up to label &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">blabel</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;.&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2235"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2236"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">try</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2237"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">DR_BREAK</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">IgnoreC</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">csid</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">clabel</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2238"></span><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">fprintnl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">stderr</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 255)">&quot;Change set is marked as ignored (due to continue) up to label &quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">clabel</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 255)">&quot;.&quot;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2239"></span><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2240"></span><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"></code>
<code id="2241"></span></code>
